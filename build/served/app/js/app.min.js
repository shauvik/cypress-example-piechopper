var app,modelDefs,types,__hasProp={}.hasOwnProperty;app=angular.module("piechopper",["ui","ui.bootstrap","ngSanitize"]),modelDefs={all:[],add:function(a){var b,c,d,e,f;for(f=modelDefs.all,b=d=0,e=f.length;e>d;b=++d)if(c=f[b],a.priority<c.priority){modelDefs.all.splice(b,0,a),a=null;break}return a?modelDefs.all.push(a):void 0}},types={checkbox:function(a){return{typeName:"checkbox","default":(null!=a?a["default"]:void 0)||!1,check:function(a){return"boolean"!=typeof a?"Value must be on / off":void 0}}},radio:function(a){return{typeName:"radio","default":!1,check:function(a){return"boolean"!=typeof a?"Value must be on / off":void 0}}},number:function(a){return{typeName:"number","default":a["default"]||0,min:null!=a?a.min:void 0,max:null!=a?a.max:void 0,unit:null!=a?a.unit:void 0,check:function(b){return"number"!=typeof b?"Value must be a number":(null!=a?a.min:void 0)&&b<a.min?"Value must be bigger than "+a.min:(null!=a?a.max:void 0)&&b>a.max?"Value must be smaller than "+a.max:void 0}}},"enum":function(a){var b,c,d;return c={typeName:"enum",values:a.values,"default":a["default"],check:function(b){var c,d,e,f;c=!1,f=a.values;for(d in f)__hasProp.call(f,d)&&(e=f[d],b===e&&(c=!0));return c?void 0:"Value must be one of "+a.values}},void 0===c["default"]&&(c["default"]=function(){var c,e,f,g;for(f=a.values,g=[],d=c=0,e=f.length;e>c;d=++c)b=f[d],g.push(d);return g}()[0]),c}};var _this=this;app.controller("AppCtrl",["$scope","$location","$http","$modal","$window","modelRepo","trace",function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p;return o=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=16*Math.random()|0,c="x"===a?b:3&b|8,c.toString(16)})},localStorage.userId||(localStorage.userId=o()),a.userId=localStorage.userId,a.repo=l=f.createRepo(modelDefs.all),a.model=j=function(){return l.activeModel},a.members=i=function(){return l.activeModel.team.members},a.criteria=function(a){return l.activeModel.modelDef.criterias[a]},a.memberColors=["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c"],a.trace=g,a.moreResultsWanted=!1,a.showMoreResults=function(b){return a.moreResultsWanted=b},p=null,a.linkToSnapshot=function(a){return void 0!==a&&(p=a),p},a.showMessage=function(a,b,c){var e,f;return f='<div class="error-dlg">\n  <h2>'+a+"</h2>\n  <d>"+b+"</d>\n</div>",e=d.open({template:f}),c?$timeout(function(){return e.dismiss()},c):void 0},a.showTos=function(){return a.showMessage("Terms and Conditions",$("#tos").html()),a.trace.showTos()},n=function(){return a.showMessage("Oops !","<p>The proposal you were looking for wasn't found.</p>\n<p>\n  Please note that proposals older than a month are deleted.\n  For more recent proposals, please check that your address is correct.\n</p>")},m=function(){return a.showMessage("Ooops !","<p>\n  There was an error while loading the given address.\n  Some parts of the proposal might not be correct!\n</p>\n<p>\n  If your data is mission critical, mail to info@piechopper.com.\n</p>")},h=function(){var a,b;for(b=[],a=1;2>=a;a++)b.push(l.addMember());return b},k=b.path().split("/"),3===k.length&&"p"===k[1]?c.get("/api/1/proposals/"+k[2]).success(function(b,c,d,e){var f;return f=l.deserialize(b.repo),f?a.$broadcast("modelLoaded"):m(),b.userId&&b.userId===a.userId?a.trace.loadOwnProposal():a.trace.loadPartnerProposal()}).error(function(a,b,c,d){return h(),n()}):k.length>=2?(h(),n()):h()}]),app.controller("CalcCtrl",["$scope","$timeout","trace",function(a,b,c){var d,e,f,g;return g=function(){var b,c,d,e,f;for(a.equities=[],e=a.members(),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(a.equities.push({name:b.name,value:b.equity}));return f},a.memberValues=function(){var b,c,d,e,f;for(e=a.members(),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.values);return f},e=null,d=function(){var c;return a.linkToSnapshot(null),e&&b.cancel(e),c=function(){return a.model().score(),g()},e=b(c,1)},a.$watch("memberValues()",d,!0),a.$watch("model().emphasis",d,!0),f=function(){return a.repo.syncMemberNames(a.model()),g()},a.memberNames=function(){var b,c,d,e,f;for(e=a.members(),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.name);return f},a.$watch("memberNames()",f,!0),a.unselectOtherRadios=function(c,d){return b(function(){var b,e,f,g,h;if(d.values[c]){for(g=a.members(),h=[],e=0,f=g.length;f>e;e++)b=g[e],b.id!==d.id?h.push(b.values[c]=!1):h.push(void 0);return h}},1)}}]),app.controller("HeaderCtrl",["$scope",function(a){return a.aboutVisible=!1}]),app.controller("ModelSelectionCtrl",["$scope","$timeout",function(a,b){var c,d,e,f,g,h,i,j,k;for(c=function(){function a(a,b,c,d,e,f,g){this.model=a,this.id=b,this.active=c,this.name=d,this.image=e,this.target=f,this.desc=g}return a}(),a.slides=h=[],k=a.repo.models,i=0,j=k.length;j>i;i++)d=k[i],f=new c(d,d.modelDef.id,d.active,d.modelDef.name,d.modelDef.image,d.modelDef.target,d.modelDef.desc),h.push(f);return g=null,e=function(){return g&&b.cancel(g),g=b(function(){return a.repo.activeModel=a.activeSlide().model,console.log("in onSlideChange timed",a.repo.activeModel.modelDef.name)},1e3)},a.activeSlide=function(){var a,b,c;for(b=0,c=h.length;c>b;b++)if(a=h[b],a.active)return a},a.$on("modelLoaded",function(){var c,d,e,f,i;for(c=a.repo.activeModel,console.log("in modelLoaded",c.modelDef.name),g&&b.cancel(g),i=[],e=0,f=h.length;f>e;e++)d=h[e],i.push(d.active=d.model===c);return i}),a.$watch(a.activeSlide,e)}]),app.controller("QuestionaryCtrl",["$scope","$http","$timeout","$rootScope",function(a,b,c,d){return a.questionary={},a.questionarySent=!1,a.sendQuestionary=function(){var c;return a.trace.sendQuestionary(),c={userId:a.userId,questionary:a.questionary},b.post("/api/1/questionaries",c).success(function(b,c,d,e){return a.questionarySent=!0}).error(function(b,c,d,e){return a.showMessage("Oops !","There was an error while saving the questionary.\n<ul>\n  <li>Please check that your internet connection works.</li>\n  <li>If it works, there might be a problem with the service. Sorry about the situation!</li>\n</ul>")})}}]),app.controller("ShareCtrl",["$scope","$http","$location",function(a,b,c){return a.linkToSnapshot(null),a.saveSnapshot=function(){var d;return d={repo:a.repo.serialize(),userId:a.userId},b.post("/api/1/proposals",d).success(function(b,d,e,f){var g,h;return g=c.host(),h=c.port(),h&&80!==h&&(g+=":"+c.port()),a.linkToSnapshot("http://"+g+"/#/p/"+b.id),a.trace.shareProposal()}).error(function(b,c,d,e){return a.showMessage("Ooops !","We couldn't save the proposal.\n<ul>\n  <li>Please check that your internet connection works.</li>\n  <li>If it works, we might have a problem on our side. Sorry about the situation!</li>\n</ul>")})}}]);var __hasProp={}.hasOwnProperty;app.directive("contenteditable",function(){return{require:"ngModel",link:function(a,b,c,d){var e;return e=c.preventEmpty||!1,d.$render=function(){return b.html(d.$viewValue)},b.bind("blur",function(){return a.$apply(function(){var a;return e&&0===b.html().replace(/^\s+|\s+$/g,"").length?b.html(d.$viewValue):(a=b.html().replace(/<br>/g," "),b.html(a),d.$setViewValue(a))})})}}}),app.directive("piegraph",function(){return{restrict:"E",replace:!0,template:'<div class="piegraph"></div>',scope:{width:"@",height:"@",slices:"=",colors:"="},link:function(a,b,c){var d,e,f,g,h,i,j,k,l;return l=[parseInt(a.width),parseInt(a.height)],k=l[0],f=l[1],i=d3.select(b[0]).append("svg").attr("width",k).attr("height",f).append("g").attr("transform","translate("+k/2+", "+f/2+")"),h=Math.min(k,f)/2-10,g=d3.layout.pie().sort(null).value(function(a){return a.value}),d=d3.svg.arc().outerRadius(h).innerRadius(0),e=d3.scale.ordinal().range(a.colors),j=function(a){var b,c,f;return c=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)f=a[b],f.value>0&&d.push(f);return d}(),i.selectAll("*").remove(),c.length>0?(b=i.selectAll(".arc").data(g(c)).enter().append("g").attr("class","arc"),b.append("path").attr("d",d).style("fill",function(a){return e(a.data.name)}),b.append("text").attr("transform",function(a){return"translate("+d.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.name})):i.append("circle").attr("r",h).attr("fill","#fff").attr("stroke","#98abc5")},a.$watch("slices",j,!0)}}}),app.directive("sliceGraph",["$compile",function(a){return{restrict:"A",scope:{width:"@",height:"@",slices:"=",colors:"="},link:function(b,c,d){var e;return e=function(){var d,e,f,g,h,i,j,k,l,m;for($(".i-slice-graph").remove(),f=[],f.push('<div class="i-slice-graph">'),h=0,m=b.slices,g=k=0,l=m.length;l>k;g=++k)i=m[g],e=0,0!==i.value&&(e=Math.round(+b.height/100*i.value)),j=[],j.push("left: 0; top: "+h+"px; width: "+ +b.width+"px; height: "+e+"px;"),j.push("background-color: "+b.colors[g]+";"),j=j.join(" "),f.push('  <div style="'+j+'" popover-placement="right" popover="'+i.name+": "+i.value+'%"></div>'),h+=e;return f.push("</div>"),d=$(f.join("")),c.append(d),a(d)(b)},b.$watch("slices",e,!0)}}}]),app.directive("showInSections",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g,h;return h=$(window),f=60,e=function(a){var b,c,d,e,g;return d=$("#"+a),c=h.scrollTop(),b=c+h.height(),g=d.offset().top,e=g+d.height(),c+f>g&&e>c},g=function(){var a,b,f,g,h;for(b=d.showInSections.split(";"),f=!1,g=0,h=b.length;h>g&&(a=b[g],!(f=e(a)));g++);return f?$(c).fadeIn():$(c).fadeOut()},$(window).scroll(function(){return g()}),a(function(){return $(c).hide(),g()},1)}}}]),app.directive("valueCell",["$compile",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f,g,h,i,j,k,l;if(j=b.$eval(d.valueCell)){switch(i=c.attr("radio-unselector"),f=[],j.typeName){case"checkbox":f.push('<input @@@ type="checkbox"'),j["default"]&&f.push('checked="checked"'),f.push("></input>");break;case"radio":f.push('<input @@@ type="checkbox"'),f.push('ng-click="'+i+'"'),f.push("></input>");break;case"number":f.push('<input @@@ type="number"'),f.push('value="'+j["default"]+'"'),f.push("select-on-focus></input>"),j.unit&&f.push('<span class="value-unit">'+j.unit+"</span>");break;case"enum":b.selectOptions=function(){var a,b;a=j.values,b=[];for(h in a)__hasProp.call(a,h)&&(k=a[h],b.push([k,h]));return b}(),f.push('<select @@@ ng-options="o[0] as o[1] for o in selectOptions">'),f.push("</select>")}return f=f.join(" "),f=f.replace("@@@",'ng-model="'+c.attr("ng-model")+'"'),g=angular.element(f),c.append(g),a(g)(b),"checkbox"===(l=j.typeName)||"radio"===l?(g.click(function(a){return a.stopPropagation()}),$(c).click(function(a){return b.$apply(function(){var a;return a=!g.prop("checked"),g.prop("checked",a),e.$setViewValue(a),c.attr("radio-unselector")&&"radio"===j.typeName?b.$eval(i):void 0})})):void 0}}}}]),app.directive("scrollTo",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){return c.bind("click",function(){return a(function(){var a,b,c;return a=d.offset||0,c=$("#"+d.scrollTo),b=d.speed||500,$("html,body").stop().animate({scrollTop:c.offset().top-a},b)},1)})}}}]),app.directive("fullyCentered",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){return $(window).resize(function(){return $(c).css({position:"absolute",left:($(window).width()-$(c).outerWidth())/2,top:($(window).height()-$(c).outerHeight())/2})}),a(function(){return $(window).resize()},1)}}}]),app.directive("selectOnFocus",function(){return{restrict:"A",link:function(a,b,c){return $(b).on("click",function(){return $(b).select()})}}}),app.directive("legacyBrowserRejector",["$window",function(a){return{restrict:"A",link:function(b,c,d){return a.onload=function(){return $.reject({reject:{all:!1,msie5:!0,msie6:!0,msie7:!0,msie8:!0},browserInfo:{firefox:{text:"Mozilla Firefox",url:"http://www.mozilla.com/firefox/"},chrome:{text:"Google Chrome",url:"http://www.google.com/chrome/"},msie:{text:"Internet Explorer",url:"http://www.microsoft.com/windows/Internet-explorer/"}},imagePath:d.browserImagePath,display:["firefox","chrome","msie"]})}}}}]),modelDefs.add({id:"d691b574-58d0-44dd-be19-7196d34d781f",name:"Market Value",version:"1.0",image:"marketValueModel.png",target:"If you want to match equity to monetary value of the contribution.",priority:20,desc:'<p>This method compares market price for each contribution in the company.\nIt considers the opportunity cost of the lost salary, as well as assets and sales\nbenefitting the project.</p>\n<p>The method is inspired by the <a href="http://www.slicingpie.com/">Slicing Pie</a> website.</p>',criterias:{marketSalary:{text:"What is the member's market salary per month?",type:types.number({"default":0,min:0,unit:"$"})},salary:{text:"How much does the member get salary from the company per month?",type:types.number({"default":0,min:0,unit:"$"})},hours:{text:"How many hours has the member been working for the company?",type:types.number({"default":0,min:0,unit:"h"})},cash:{text:"How much cash is the member investing?",type:types.number({"default":0,min:0,unit:"$"})},otherItems:{text:"How much does the member bring in other valuables (premises, tools etc.)?",type:types.number({"default":0,min:0,unit:"$"})},sales:{text:"How much sales revenue is the member bringing in?",type:types.number({"default":0,min:0,unit:"$"})},salesCommissionPercent:{text:"What is the sales commission percent that is usually paid on the market?",type:types.number({"default":0,min:0,max:100,unit:"%"})},salesCommissionPaid:{text:"How much sales commission has been paid to the member?",type:types.number({"default":0,min:0,unit:"$"})}},emphasis:{salary:{text:"How much do you value contributed work?",type:types.number({"default":200,min:0,unit:"%"})},cash:{text:"How much do you value contributed cash?",type:types.number({"default":400,min:0,unit:"%"})},otherItems:{text:"How much do you value contributed other items?",type:types.number({"default":400,min:0,unit:"%"})},sales:{text:"How much do you value sales?",type:types.number({"default":200,min:0,unit:"%"})}},score:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o;for(h=0,k=0,m=b.length;m>k;k++)e=b[k],f=e.scores={slice:0},g=e.values,i=(g.marketSalary-g.salary)/160*g.hours*(d.salary/100),0>i&&(c.push(""+e.name+"'s salary is too high."),i=0),f.slice=i,f.slice+=g.cash*(d.cash/100),f.slice+=g.otherItems*(d.otherItems/100),j=(g.sales*g.salesCommissionPercent/100-g.salesCommissionPaid)*(d.sales/100),0>j&&(c.push(""+e.name+"'s sales commission is too high."),i=0),f.slice+=j,h+=f.slice;for(o=[],l=0,n=b.length;n>l;l++)e=b[l],o.push(e.equity=Math.round(e.scores.slice/h*1e3)/10||0);return o}});var __hasProp={}.hasOwnProperty;!function(){var a;return a=function(){return types["enum"]({"default":0,values:{None:0,Little:2,Some:5,Plenty:10}})},modelDefs.add({id:"6cfb9e85-90fc-4faa-954a-d99c8a9adc33",name:"Company Roles",version:"1.0",image:"roleBasedModel.png",target:"If you want to share equity based on roles in the company.",priority:10,desc:'<p>This method considers executive, development and business roles in the company,\nand scores each team member based on their contributions for each role.</p>\n<p>The method is inspired by the <a href="http://foundrs.com/">Foundrs.com</a> website.</p>',criterias:{idea:{text:"Who had the original idea for the project?",type:types.checkbox()},participation:{text:"Compared to full time job, how much time the member contributes until you raise funding?",info:"100 = full time, 50 = half-time, 120 = 20% overtime",type:types.number({"default":100,min:1,max:250,unit:"%"})},techParticipation:{text:"How much does the member participate into technical development?",type:a()},techLead:{text:"Who would lead the technical team if you would get more personnel?",type:types.radio()},leaveTech:{text:"If the member would leave the project, how much would it affect the development schedule?",type:a()},leaveFunding:{text:"If the member would leave the project, how much would it affect the chances of getting funded?",type:a()},launch:{text:"If the member would leave the project, how much would it affect the launch or initial traction?",type:a()},revenue:{text:"If the member would leave the project, how much would it affect generating the revenue quickly?",type:a()},pr:{text:"How much does the member participate to the creation of marketing materials?",type:a(),score:function(a,b){return a.biz+=b/5}},features:{text:"How much does the member contribute to the product features?",type:a()},budget:{text:"Who maintains the budgeting spreadsheets?",type:types.radio()},expenses:{text:"How much does the member contribute to the business expenses (business cards, web hosting...)?",type:a()},pitch:{text:"Who pitches investors?",type:types.radio()},connections:{text:"How well is the member connected with the target industry (potential customers, journalists, influencers)?",type:a()},ceo:{text:"Who is or becomes the CEO?",type:types.radio()}},emphasis:{ceo:{text:"How much do you value the executive role?",info:"100 = normal valuation, 50 = half-valuation, 200 = double valuation",type:types.number({"default":140,min:1,max:250,unit:"%"})},dev:{text:"How much do you value the development role?",info:"100 = normal valuation, 50 = half-valuation, 200 = double valuation",type:types.number({"default":120,min:1,max:250,unit:"%"})},biz:{text:"How much do you value the business and marketing role?",info:"100 = normal valuation, 50 = half-valuation, 200 = double valuation",type:types.number({"default":100,min:1,max:250,unit:"%"})}},score:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;for(o=b.filter(function(a){return a.values.ceo})[0],e=function(a,b){var c,d,e;e=[];for(c in b)__hasProp.call(b,c)&&(d=b[c],e.push(a[c]+=d));return e},p={ceo:0,dev:0,biz:0},s=0,u=b.length;u>s;s++){j=b[s],l=j.scores={ceo:0,dev:0,biz:0},m=j.values,m.idea&&e(l,{ceo:5,dev:3,biz:3}),e(l,{dev:m.techParticipation}),m.techLead&&e(l,{ceo:1,dev:10}),e(l,{ceo:m.leaveTech/10,dev:m.leaveTech}),e(l,{ceo:m.leaveFunding}),e(l,{ceo:m.launch/3,dev:m.launch/3,biz:m.launch/3}),e(l,{ceo:m.revenue/5,biz:m.revenue}),e(l,{biz:m.pr/5}),e(l,{ceo:m.features/2,dev:m.features/5,biz:m.features/5}),m.budget&&e(l,{ceo:3,biz:5}),e(l,{ceo:m.expenses/5,biz:m.expenses/5}),m.pitch&&e(l,{ceo:10,biz:1}),e(l,{ceo:m.connections/3,biz:m.connections}),m.ceo&&e(l,{ceo:10});for(i in l)__hasProp.call(l,i)&&(r=l[i],q=l[i]=l[i]*(m.participation/100),p[i]+=q)}for(o?o.scores.ceo<35&&c.push("You appear to have a weak CEO."):c.push("You haven't selected the CEO."),p.dev<25&&c.push("You should strengthen your development team."),p.biz<20&&c.push("You should strengthen your business and marketing team."),g=d.ceo/100,h=d.dev/100,f=d.biz/100,n=p.ceo*g+p.dev*h+p.biz*f,w=[],t=0,v=b.length;v>t;t++)j=b[t],l=j.scores,k=l.ceo*g+l.dev*h+l.biz*f,j.equity=Math.round(k/n*1e3)/10||0,o&&l.ceo>o.scores.ceo?w.push(c.push("Maybe "+j.name+" should be the CEO.")):w.push(void 0);return w}})}();var __hasProp={}.hasOwnProperty;modelDefs.add({id:"6ee7289c-6eb6-4239-9fe1-5ded5dd511e4",name:"Relative Importance",version:"1.0",image:"weightedAspectsModel.png",target:"If you want something quick and simple",priority:30,desc:"<p>This method considers relative importance of various aspect related to establishing a company. It's quick to fill, though highly subjective.</p>\n<p>The method is inspired by the <a href=\"http://www.andrew.cmu.edu/user/fd0n/35%20Founders'%20Pie%20Calculator.htm\">Founders Pie Calculator</a>.</p>",criterias:{idea:{text:"How much has the member been contributing to the original idea? (0-10)",type:types.number({"default":0,min:0,max:10})},businessPlan:{text:"How much has the member been contributing to the business plan? (0-10)",type:types.number({"default":0,min:0,max:10})},domainExpertise:{text:"How well does the member know your target industry, and how well they are connected? (0-10)",type:types.number({"default":0,min:0,max:10})},commitmentAndRisk:{text:"How committed the member is in terms of consumed time and money? (0-10)",type:types.number({"default":0,min:0,max:10})},responsibilities:{text:"How demanding are the responsibilities of the member? (0-10)",type:types.number({"default":0,min:0,max:10})}},emphasis:{idea:{text:"How much do you value the idea? (0-10)",type:types.number({"default":5,min:0,max:10})},businessPlan:{text:"How much do you value the business plan? (0-10)",type:types.number({"default":5,min:0,max:10})},domainExpertise:{text:"How much do you value the domain expertise? (0-10)",type:types.number({"default":5,min:0,max:10})},commitmentAndRisk:{text:"How much do you value the commitment and risk? (0-10)",type:types.number({"default":5,min:0,max:10})},responsibilities:{text:"How much do you value the demandingness of responsibilities? (0-10)",type:types.number({"default":5,min:0,max:10})}},score:function(a,b,c,d){var e,f,g,h,i,j,k,l,m;for(g=0,i=0,k=b.length;k>i;i++){f=b[i],f.scores={slice:0};for(e in d)__hasProp.call(d,e)&&(h=d[e],f.scores.slice+=f.values[e]*h);g+=f.scores.slice}for(m=[],j=0,l=b.length;l>j;j++)f=b[j],m.push(f.equity=Math.round(f.scores.slice/g*1e3)/10||0);return m}});var __hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};app.service("modelRepo",function(){var a,b,c,d;return a=function(){function a(a,b,c){var d,e;this.id=a,this.name=b,this.modelDef=c,this.values={},this.scores={},this.valueErrors={},e=c.criterias;for(a in e)__hasProp.call(e,a)&&(d=e[a],this.values[a]=d.type["default"]);this.equity=0}return a}(),d=function(){function b(a){this.modelDef=a,this.members=[],this.messages=[]}return b.prototype.addMember=function(b,c){var d;return d=new a(b,c,this.modelDef),this.members.push(d),d},b.prototype.removeMember=function(a){return this.members.splice(a,1)},b}(),b=function(){function a(a){this.modelDef=a,this.emphasis={},this.emphasisErrors={},this.hasInputErrors=!1,this.init()}return a.prototype.init=function(){var a,b,c,e;this.team=new d(this.modelDef),c=this.modelDef.emphasis,e=[];for(b in c)__hasProp.call(c,b)&&(a=c[b],e.push(this.emphasis[b]=a.type["default"]));return e},a.prototype.score=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(this.hasInputErrors=!1,o=this.team.members,i=0,l=o.length;l>i;i++){d=o[i],p=d.values;for(c in p)__hasProp.call(p,c)&&(h=p[c],g=this.modelDef.criterias[c].type,b=g.check(h),b?(d.valueErrors[c]=b,this.hasInputErrors=!0):d.valueErrors[c]&&delete d.valueErrors[c])}q=this.emphasis;for(c in q)__hasProp.call(q,c)&&(h=q[c],g=this.modelDef.emphasis[c].type,b=g.check(h),b?(this.emphasisErrors[c]=b,this.hasInputErrors=!0):this.emphasisErrors[c]&&delete this.emphasisErrors[c]);for(this.team.messages=[],this.modelDef.score(this.modelDef,this.team.members,this.team.messages,this.emphasis),a=!0,r=this.team.members,j=0,m=r.length;m>j;j++)if(e=r[j],0!==e.equity){a=!1;break}if(a){for(f=Math.round(100/this.team.members.length*10)/10,s=this.team.members,t=[],k=0,n=s.length;n>k;k++)e=s[k],t.push(e.equity=f);return t}},a.prototype.getCriteriaIds=function(){var a,b,c,d;c=this.modelDef.criterias,d=[];for(a in c)__hasProp.call(c,a)&&(b=c[a],d.push(a));return d},a.prototype.getEmphasisIds=function(){var a,b,c,d;c=this.emphasis,d=[];for(a in c)__hasProp.call(c,a)&&(b=c[a],d.push(a));return d},a}(),c=function(){function a(a){var b,c,d,e;for(this.modelDefList=a,this.defaultMemberIds="ABCDEFGHIJKLMN",this.usedMemberIds=[],this.models=[],e=this.modelDefList,c=0,d=e.length;d>c;c++)b=e[c],this.createModel(b);this.activeModel=this.models[0]}return a.prototype.init=function(){var a,b,c,d,e;for(this.usedMemberIds=[],d=this.models,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.init());return e},a.prototype.createModel=function(a){return this.models.push(new b(a))},a.prototype.isTeamAtMax=function(){return this.memberCount()>=6},a.prototype.isTeamAtMin=function(){return this.memberCount()<=2},a.prototype.memberCount=function(){return this.usedMemberIds.length},a.prototype.getNextMemberId=function(){var a,b,c,d;for(d=this.defaultMemberIds,b=0,c=d.length;c>b;b++)if(a=d[b],__indexOf.call(this.usedMemberIds,a)<0)return a;return"X"},a.prototype.addMember=function(a,b){var c,d,e,f,g,h,i;if(!this.isTeamAtMax()){for(c=a||this.getNextMemberId(),this.usedMemberIds.push(c),d=b||"Member "+c,h=this.models,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(e.team.addMember(c,d));return i}},a.prototype.removeMember=function(a){var b,c,d,e,f;if(!this.isTeamAtMin()){for(this.usedMemberIds.splice(a,1),e=this.models,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.team.removeMember(a));return f}},a.prototype.syncMemberNames=function(a){var b,c,d,e,f,g,h,i;for(d=a.team.members,h=this.models,i=[],f=0,g=h.length;g>f;f++)e=h[f],e!==a?i.push(function(){var a,f,g,h;for(g=e.team.members,h=[],b=a=0,f=g.length;f>a;b=++a)c=g[b],h.push(c.name=d[b].name);return h}()):i.push(void 0);return i},a.prototype.serialize=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;for(f={activeModelId:this.activeModel.modelDef.id,models:{}},l=this.models,h=0,j=l.length;j>h;h++){for(c=l[h],f.models[c.modelDef.id]=e={},e.version=c.modelDef.version,e.name=c.modelDef.name,e.team={},e.team.members=[],m=c.team.members,i=0,k=m.length;k>i;i++)b=m[i],d={},d.id=b.id,d.name=b.name,d.values=b.values,e.team.members.push(d);e.emphasis={},n=c.emphasis;for(a in n)__hasProp.call(n,a)&&(g=n[a],e.emphasis[a]=g)}return f},a.prototype.deserialize=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;this.init(),c=[],b=function(a,b,d){return typeof b!==d?c.push("field "+a+": "+b+" is not of type "+d):void 0};try{d=!0,b("sRepo",a,"object"),b("sRepo.activeModelId",a.activeModelId,"string"),b("sRepo",a.models,"object"),s=a.models;for(f in s)if(__hasProp.call(s,f)){for(n=s[f],t=[f,n],e=t[0],m=t[1],b("sModel.id",e,"string"),b("sModel",m,"object"),j=!1,u=this.models,o=0,q=u.length;q>o;o++)if(i=u[o],i.modelDef.id===e){for(a.activeModelId===e&&(this.activeModel=i),b("sModel.version",m.version,"string"),g=parseInt(i.modelDef.version.split(".")[0]),k=parseInt(m.version.split(".")[0]),g!==k&&c.push("Major versions differ in model "+e),b("sModel.team",m.team,"object"),b("sModel.team.members",m.team.members,"object"),v=m.team.members,p=0,r=v.length;r>p;p++)l=v[p],d&&(b("sMember.id",l.id,"string"),this.usedMemberIds.push(l.id)),b("sMember.name",l.name,"string"),h=i.team.addMember(l.id,l.name),b("sMember.values",l.values,"object"),h.values=l.values;if(m.emphasis){b("sModel.emphasis",m.emphasis,"object"),w=m.emphasis;for(f in w)__hasProp.call(w,f)&&(n=w[f],i.emphasis[f]=n)}j=!0}j||c.push("Couldn't find model '"+name+"' to deserialize into"),d=!1}}catch(x){}return c.length>0&&console.error("Errors while deserializing:\n  -",c.join("\n  - ")),0===c.length},a}(),this.createRepo=function(a){return new c(a)},this}),app.service("trace",["$window",function(a){var b;return b={},this.createGaArray=function(a,b){for(a=a.split(":"),0===a[0].length&&(a=[]),a.length>3&&(a=a.slice(0,3));a.length<3;)a.push(null);return a.push(b),["_trackEvent"].concat(a)},this.trace=function(c,d){var e;return void 0===b[c]?b[c]=1:b[c]+=1,e=this.createGaArray(c,d),a._gaq&&a._gaq.push(e),e},this.traceFirst=function(a,c){return 1===b[a]?[]:this.trace(a,c)},this.addMember=function(){return this.traceFirst("Click:Add / Remove Member",10)},this.removeMember=function(){return this.traceFirst("Click:Add / Remove Member",10)},this.changeMemberName=function(){return this.traceFirst("Click:Change Member Name",20)},this.openEmail=function(){return this.traceFirst("Click:Open Email",20)},this.openTwitter=function(){return this.traceFirst("Click:Open Twitter",5)},this.openGithub=function(){return this.traceFirst("Click:Open Github",5)},this.showAbout=function(){return this.traceFirst("Click:Show About",5)},this.showTos=function(){return this.traceFirst("Click:Show TOS",10)},this.wantMoreResults=function(){return this.trace("Click:Show More Results",80)},this.cancelMoreResults=function(){return this.trace("Click:Cancel More Results",-80)},this.loadOwnProposal=function(){return this.trace("Persist:Load Own Proposal",60)},this.loadPartnerProposal=function(){return this.trace("Persist:Load Partner Proposal",100)},this.shareProposal=function(){return this.trace("Persist:Share Prososal",80)},this.sendQuestionary=function(){return this.trace("Persist:Send Questionary",150)},this.changeContrib=function(){return this.traceFirst("Click:Change Contrib",1)},this.changeEmphasis=function(){return this.traceFirst("Click:Change Emphasis",2)},this.switchModel=function(){return this.traceFirst("Click:Switch Model",10,3)},this}]);